<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Fafi - Gi·∫£i M√£ T√†i Ch√≠nh</title>
    <style>
        :root {
            --primary-color: #FFD700; /* V√†ng kim */
            --secondary-color: #FF8C00;
            --popup-bg: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-image: url('Giai_ma_tai_chinh_nen.png'); 
            background-size: cover;
            background-position: center bottom;
            background-repeat: no-repeat;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-window {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        /* --- CANVAS PH√ÅO HOA --- */
        #fireworks-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; 
            z-index: 300; 
        }

        /* --- M√ÄN H√åNH MENU --- */
        #menu-screen {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* D·∫£i ng√¥i sao v√≤ng cung */
        .arc-stars-container {
            position: absolute;
            top: 32%; left: 50%;
            transform: translateX(-50%);
            width: 280px; height: 80px; 
            pointer-events: none; 
            z-index: 5;
        }
        .arc-star {
            position: absolute;
            width: 35px; height: 35px;
            background-image: url('https://img.icons8.com/emoji/48/star-emoji.png');
            background-size: cover;
            filter: drop-shadow(0 0 8px #FFD700);
            animation: twinkle-gold 2s infinite ease-in-out;
        }
        .as-1 { top: 25px; left: 0; animation-delay: 0s; }
        .as-2 { top: 5px;  left: 60px; animation-delay: 0.4s; }
        .as-3 { top: 0;    left: 122px; animation-delay: 0.8s; }
        .as-4 { top: 5px;  left: 185px; animation-delay: 1.2s; }
        .as-5 { top: 25px; left: 245px; animation-delay: 1.6s; }

        @keyframes twinkle-gold {
            0%, 100% { opacity: 0.7; transform: scale(1); filter: drop-shadow(0 0 5px #FFD700); }
            50% { opacity: 1; transform: scale(1.2); filter: drop-shadow(0 0 12px #FFD700); }
        }

        /* T√öI TI·ªÄN */
        .money-bag-btn {
            position: absolute;
            width: 150px; height: 150px;
            cursor: pointer;
            background-image: url('https://img.icons8.com/fluency/240/money-bag.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            filter: sepia(1) hue-rotate(5deg) saturate(3) brightness(1.1) contrast(1.2) drop-shadow(0 5px 15px rgba(255, 215, 0, 0.6));
            z-index: 10;
            display: flex; justify-content: center; align-items: flex-end;
            animation: float 3s ease-in-out infinite;
            transition: transform 0.3s ease, filter 0.3s;
        }
        
        /* --- C·∫¨P NH·∫¨T V·ªä TR√ç M·ªöI --- */
        
        /* FAFI 1: B√™n Tr√°i (Gi·ªØ nguy√™n) */
        #bag-1 { bottom: 9%; left: 36%; animation-delay: 0s; }
        
        /* FAFI 2: ·ªû Gi·ªØa (M·ªõi c·∫≠p nh·∫≠t) */
        #bag-2 { top: 69%; left: 45%; animation-delay: 0.7s; }
        
        /* FAFI 3: B√™n Ph·∫£i (M·ªõi c·∫≠p nh·∫≠t) */
        #bag-3 { bottom: 9%; right: 36%; animation-delay: 1.5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .bag-label {
            font-size: 1.2rem; font-weight: bold; color: #fff;
            text-shadow: 2px 2px 4px #000;
            background-color: #FF8C00;
            padding: 5px 15px; border-radius: 20px;
            margin-bottom: -10px; border: 2px solid #fff;
            pointer-events: none; white-space: nowrap;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            position: relative; z-index: 20; filter: none;
        }

        .money-bag-btn:hover {
            filter: sepia(1) hue-rotate(5deg) saturate(4) brightness(1.3) contrast(1.3) drop-shadow(0 0 25px #FFFF00);
            transform: scale(1.1) translateY(-5px);
            z-index: 100;
        }

        /* SAO B·∫ÆN RA */
        .hover-star {
            position: absolute; width: 40px; height: 40px;
            background-image: url('https://img.icons8.com/emoji/48/star-emoji.png');
            background-size: cover;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0; z-index: -1;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: none;
        }
        .money-bag-btn:hover .star-1 { transform: translate(-70px, -60px) scale(1) rotate(-20deg); opacity: 1; }
        .money-bag-btn:hover .star-2 { transform: translate(0px, -90px) scale(0.8) rotate(0deg); opacity: 1; }
        .money-bag-btn:hover .star-3 { transform: translate(70px, -60px) scale(1) rotate(20deg); opacity: 1; }

        .bag-completed::after {
            content: '‚úì'; position: absolute; top: 0px; right: 0px;
            background: #4CAF50; color: white; width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: bold; border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 25; filter: none;
        }

        /* --- POPUP --- */
        #quiz-screen, #result-screen {
            display: none; background-color: var(--popup-bg);
            width: 75%; max-width: 800px; padding: 30px;
            border-radius: 25px; border: 4px solid var(--primary-color);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5), 0 15px 50px rgba(0,0,0,0.6);
            text-align: center; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 200;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { opacity: 0; transform: translate(-50%, -40%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        h2 { color: var(--secondary-color); margin-top: 0; font-size: 2.2rem; margin-bottom: 10px; text-transform: uppercase;}

        .question-box {
            background: #FFF8E1; padding: 20px; border-radius: 15px;
            font-size: 1.5rem; color: #E65100; font-weight: bold;
            margin: 15px 0 25px 0; border: 2px dashed #FFB74D;
            min-height: 80px; display: flex; align-items: center; justify-content: center;
        }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        .option-btn {
            padding: 18px; font-size: 1.2rem; border-radius: 15px;
            border: 3px solid #eee; background: white; cursor: pointer;
            transition: all 0.2s; font-weight: 600; color: #444;
        }
        .option-btn:hover:not(:disabled) { 
            background: #fff3e0; border-color: orange; 
            transform: translateY(-3px); box-shadow: 0 5px 15px rgba(255, 140, 0, 0.2);
        }
        .correct { background: #C8E6C9 !important; border-color: #4CAF50 !important; color: #1B5E20; }
        .wrong { background: #FFCDD2 !important; border-color: #F44336 !important; color: #B71C1C; }

        .next-btn, .back-btn {
            padding: 12px 40px; font-size: 1.3rem;
            background: linear-gradient(to right, #FF8C00, #FFD700);
            color: white; border: none; border-radius: 50px; cursor: pointer;
            margin-top: 25px; font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.4);
            transition: transform 0.2s;
        }
        .next-btn:hover, .back-btn:hover { transform: scale(1.1); }

        #feedback-area {
            margin-top: 20px; padding: 15px; border-radius: 12px;
            font-weight: bold; font-size: 1.2rem; display: none;
        }

        #result-screen { display: none; flex-direction: column; align-items: center; justify-content: center; }

        .trophy-container {
            position: relative; width: 200px; height: 200px;
            margin: 0 auto 20px auto; display: flex;
            justify-content: center; align-items: center;
        }
        .sunburst {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(255,255,255,0) 70%);
            animation: rotateBurst 10s linear infinite; z-index: 1;
        }
        @keyframes rotateBurst { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .trophy-img {
            width: 160px; height: 160px; z-index: 2;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3));
            animation: bounceIn 1s infinite alternate;
        }
        @keyframes bounceIn { from { transform: scale(1); } to { transform: scale(1.05); } }
        .star {
            position: absolute; width: 50px; height: 50px;
            background-image: url('https://img.icons8.com/emoji/96/star-emoji.png');
            background-size: cover; z-index: 3;
            animation: twinkle 1.5s infinite ease-in-out;
        }
        .star-left { top: 60%; left: -20px; animation-delay: 0s; transform: rotate(-15deg); }
        .star-right { top: 60%; right: -20px; animation-delay: 0.5s; transform: rotate(15deg); }
        .star-top { top: -10px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; animation-delay: 1s; }
        @keyframes twinkle {
            0%, 100% { opacity: 0.8; transform: scale(1) rotate(var(--r, 0deg)); }
            50% { opacity: 1; transform: scale(1.2) rotate(var(--r, 0deg)); }
        }

        .score-box { font-size: 1.8rem; color: #333; margin-bottom: 10px; }
        .score-number { color: #E65100; font-size: 3.5rem; font-weight: 800; }
        #cheer-msg { font-size: 1.4rem; color: #555; max-width: 80%; margin: 0 auto; line-height: 1.5; }

        .coin {
            position: absolute; top: -50px; width: 40px; height: 40px;
            background-image: url('https://img.icons8.com/emoji/48/coin-emoji.png');
            background-size: cover; z-index: 300;
            animation: fall linear forwards; pointer-events: none;
        }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

<audio id="sound-win" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>
<audio id="sound-lose" src="https://www.soundjay.com/misc/sounds/fail-trombone-01.mp3"></audio>

<div class="game-window">
    
    <canvas id="fireworks-canvas"></canvas>

    <div id="menu-screen">
        <div class="arc-stars-container">
            <div class="arc-star as-1"></div><div class="arc-star as-2"></div><div class="arc-star as-3"></div><div class="arc-star as-4"></div><div class="arc-star as-5"></div>
        </div>

        <div class="money-bag-btn" id="bag-1" onclick="startQuiz(0)">
            <span class="bag-label">FAFI 1</span>
            <div class="hover-star star-1"></div><div class="hover-star star-2"></div><div class="hover-star star-3"></div>
        </div>

        <div class="money-bag-btn" id="bag-2" onclick="startQuiz(1)">
            <span class="bag-label">FAFI 2</span>
            <div class="hover-star star-1"></div><div class="hover-star star-2"></div><div class="hover-star star-3"></div>
        </div>

        <div class="money-bag-btn" id="bag-3" onclick="startQuiz(2)">
            <span class="bag-label">FAFI 3</span>
            <div class="hover-star star-1"></div><div class="hover-star star-2"></div><div class="hover-star star-3"></div>
        </div>
    </div>

    <div id="quiz-screen">
        <h2 id="group-title">FAFI X</h2>
        <div style="text-align: right; color: #777; font-size:1rem; font-weight: bold;" id="q-progress">1/7</div>
        <div class="question-box" id="question-text">C√¢u h·ªèi...</div>
        <div class="options-grid" id="options-container"></div>
        <div id="feedback-area"></div>
        <button class="next-btn" id="next-btn" onclick="nextQuestion()" style="display:none;">Ti·∫øp theo ‚ûú</button>
    </div>

    <div id="result-screen">
        <h2 style="font-size: 2.5rem; margin-bottom: 10px;">K·∫æT QU·∫¢</h2>
        <div class="trophy-container">
            <div class="sunburst"></div>
            <img src="https://img.icons8.com/fluency/240/trophy.png" alt="Trophy" class="trophy-img">
            <div class="star star-left" style="--r: -15deg"></div><div class="star star-right" style="--r: 15deg"></div><div class="star star-top" style="--r: 0deg"></div>
        </div>
        <div class="score-box">S·ªë c√¢u ƒë√∫ng: <span class="score-number" id="final-score">0/7</span></div>
        <p id="cheer-msg">Tuy·ªát v·ªùi!</p>
        <button class="back-btn" onclick="goHome()">V·ªÅ m√†n h√¨nh ch√≠nh</button>
    </div>

</div>

<script>
    // --- 1. LOGIC PH√ÅO HOA (CANVAS) ---
    const canvas = document.getElementById('fireworks-canvas');
    const ctx = canvas.getContext('2d');
    let fireworks = [];
    let isFireworksActive = false;

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Particle {
        constructor(x, y, color) {
            this.x = x; this.y = y; this.color = color;
            this.velocity = { x: (Math.random() - 0.5) * 8, y: (Math.random() - 0.5) * 8 };
            this.alpha = 1; this.friction = 0.96;
        }
        draw() {
            ctx.globalAlpha = this.alpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 4, 0, Math.PI * 2, false);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
        update() {
            this.velocity.x *= this.friction;
            this.velocity.y *= this.friction;
            this.x += this.velocity.x;
            this.y += this.velocity.y + 0.1; 
            this.alpha -= 0.01;
            this.draw();
        }
    }

    function createFirework(x, y) {
        const particleCount = 40;
        const colors = ['#ff0040', '#ff00ff', '#00ffff', '#ffff00', '#00ff00'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        for (let i = 0; i < particleCount; i++) {
            fireworks.push(new Particle(x, y, color));
        }
    }

    function animateFireworks() {
        if (!isFireworksActive && fireworks.length === 0) return;
        requestAnimationFrame(animateFireworks);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        fireworks.forEach((particle, index) => {
            if (particle.alpha > 0) {
                particle.update();
            } else {
                fireworks.splice(index, 1);
            }
        });
    }

    function startFireworks() {
        isFireworksActive = true;
        animateFireworks();
        let interval = setInterval(() => {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height * 0.5;
            createFirework(x, y);
        }, 300);

        setTimeout(() => {
            clearInterval(interval);
            isFireworksActive = false;
        }, 4000);
    }

    // --- 2. D·ªÆ LI·ªÜU GAME ---
    const quizData = [
        // FAFI 1
        [
            { q: "Ti·ªÅn d√πng ƒë·ªÉ l√†m g√¨?", a: ["G·∫•p m√°y bay", "Mua b√°n, trao ƒë·ªïi", "V·∫Ω tranh", "L√†m ƒë·ªì ch∆°i"], correct: 1, explain: "Ti·ªÅn l√† ph∆∞∆°ng ti·ªán trao ƒë·ªïi h√†ng h√≥a." },
            { q: "T·ªù ti·ªÅn 2.000ƒë l√†m b·∫±ng g√¨?", a: ["Cotton (Gi·∫•y)", "Polymer", "Kim lo·∫°i", "G·ªó"], correct: 0, explain: "Ti·ªÅn m·ªánh gi√° nh·ªè l√†m b·∫±ng gi·∫•y Cotton." },
            { q: "Ti·ªÅn ƒë·∫øn t·ª´ ƒë√¢u?", a: ["T·ª± sinh ra", "√îng B·ª•t t·∫∑ng", "Lao ƒë·ªông", "Nh·∫∑t ƒë∆∞·ª£c"], correct: 2, explain: "Ti·ªÅn ƒë·∫øn t·ª´ s·ª©c lao ƒë·ªông ch√¢n ch√≠nh." },
            { q: "ƒê∆°n v·ªã ti·ªÅn t·ªá Vi·ªát Nam?", a: ["Xu", "ƒê·ªìng (VND)", "USD", "Y√™n"], correct: 1, explain: "ƒê∆°n v·ªã l√† ƒê·ªìng (VND)." },
            { q: "Ph√¢n bi·ªát ti·ªÅn th·∫≠t?", a: ["Soi h√¨nh ch√¨m, s·ªù g·ªù n·ªïi", "Ng·ª≠i", "Vi·∫øt t√™n", "Gi·∫•u ƒëi"], correct: 0, explain: "C·∫ßn quan s√°t c√°c y·∫øu t·ªë b·∫£o an." },
            { q: "V√≠ d·ª• v·ªÅ 'Nhu c·∫ßu'?", a: ["B√∫p b√™", "K·∫πo", "S√°ch v·ªü", "Game"], correct: 2, explain: "S√°ch v·ªü c·∫ßn thi·∫øt cho h·ªçc t·∫≠p." },
            { q: "V√≠ d·ª• v·ªÅ 'Mong mu·ªën'?", a: ["C∆°m", "Qu·∫ßn √°o", "Thu·ªëc", "ƒê·ªì ch∆°i x·ªãn"], correct: 3, explain: "ƒê·ªì ch∆°i l√† mong mu·ªën, ch∆∞a c·∫ßn g·∫•p." }
        ],
        // FAFI 2
        [
            { q: "Nguy√™n t·∫Øc chi ti√™u?", a: ["Th√≠ch l√† mua", "C·∫¶N tr∆∞·ªõc - MU·ªêN sau", "Mua h·∫øt", "Nh·ªãn ƒÉn"], correct: 1, explain: "∆Øu ti√™n nhu c·∫ßu c·∫ßn thi·∫øt tr∆∞·ªõc." },
            { q: "B·ªØa s√°ng n√™n ch·ªçn?", a: ["ƒê·ªì ch∆°i", "B√°nh m√¨", "C·∫£ hai", "Nh·ªãn"], correct: 1, explain: "ƒÇn s√°ng b·∫£o v·ªá s·ª©c kh·ªèe." },
            { q: "Ti·∫øt ki·ªám l√†?", a: ["Ti√™u s·∫°ch", "Gi·ªØ l·∫°i 1 ph·∫ßn cho t∆∞∆°ng lai", "Xin th√™m", "C·∫•t m√£i"], correct: 1, explain: "T√≠ch l≈©y cho m·ª•c ti√™u t∆∞∆°ng lai." },
            { q: "Ti·∫øt ki·ªám KH√îNG ph·∫£i l√†?", a: ["C√≥ k·∫ø ho·∫°ch", "H·ª£p l√Ω", "Keo ki·ªát, b·ªßn x·ªân", "Th√¥ng minh"], correct: 2, explain: "Ti·∫øt ki·ªám kh√°c v·ªõi keo ki·ªát." },
            { q: "B∆∞·ªõc ƒë·∫ßu c·ªßa ti·∫øt ki·ªám l√†?", a: ["ƒêi ng·ªß", "ƒê·∫∑t m·ª•c ti√™u", "ƒê·∫øm ti·ªÅn", "ƒê√≤i qu√†"], correct: 1, explain: "Ph·∫£i bi·∫øt ti·∫øt ki·ªám ƒë·ªÉ l√†m g√¨." },
            { q: "N·∫øu c√≥ ti·ªÅn, c·∫ßn ∆∞u ti√™n?", a: ["Mua ƒë·ªì c·∫ßn", "Mua ƒë·ªì th√≠ch", "Kh√¥ng mua", "Vung tay mua s·∫Øm"], correct: 0, explain: "Chi ti·ªÅn v√†o ƒë√∫ng vi·ªác c·∫ßn." },
            { q: "N√™n ph√¢n chia ti·ªÅn th√†nh m·∫•y ph·∫ßn?", a: ["Ba ph·∫ßn", "Hai ph·∫ßn", "M·ªôt ph·∫ßn", "Kh√¥ng bi·∫øt"], correct: 0, explain: "N√™n chia ti·ªÅn th√†nh 3 ph·∫ßn l√†: 'Nhu c·∫ßu', 'Mong mu·ªën' v√† 'Ti·∫øt ki·ªám'." }
        ],
        // FAFI 3
        [
            { q: "3 h≈© t√†i ch√≠nh bao g·ªìm nh·ªØng h≈© n√†o?", a: ["ƒÇn-Ng·ªß-Ch∆°i", "Chi ti√™u-Ti·∫øt ki·ªám-Chia s·∫ª", "Mua-B√°n-T·∫∑ng", "S√°ng-Chi·ªÅu-T·ªëi"], correct: 1, explain: "Chi ti√™u, Ti·∫øt ki·ªám, Chia s·∫ª." },
            { q: "H≈© Chia s·∫ª ƒë·ªÉ l√†m g√¨?", a: ["Mua ƒë·ªì", "Gi√∫p ƒë·ª°, y√™u th∆∞∆°ng", "Mua k·∫πo", "C·∫•t ƒëi"], correct: 1, explain: "Lan t·ªèa y√™u th∆∞∆°ng t·ªõi c·ªông ƒë·ªìng." },
            { q: "Ngo√†i ti·ªÅn, c√≥ th·ªÉ chia s·∫ª?", a: ["R√°c", "ƒê·ªì h·ªèng", "Th·ªùi gian, c√¥ng s·ª©c", "S·ª± t·ª©c gi·∫≠n"], correct: 2, explain: "Chia s·∫ª th·ªùi gian v√† s·ª± quan t√¢m." },
            { q: "N·∫øu c√≥ 1 m√≥n ƒë·ªì c√≤n t·ªët nh∆∞ng kh√¥ng c·∫ßn s·ª≠ d·ª•ng n·ªØa th√¨ ch√∫ng ta n√™n l√†m g√¨?", a: ["B√°n l·∫°i gi√° cao", "G·ª≠i cho nh·ªØng b·∫°n nh·ªè g·∫∑p ho√†n c·∫£nh kh√≥ khƒÉn", "V·ª©t ƒëi", "Ph√° n√≥"], correct: 1, explain: "C√°c b·∫°n nh·ªè ƒë∆∞·ª£c gi√∫p ƒë·ª° s·∫Ω r·∫•t h·∫°nh ph√∫c ƒë√≥." },
            { q: "L√† 1 Th·ªß Lƒ©nh T√†i ch√≠nh, con s·∫Ω s·ª≠ d·ª•ng ti·ªÅn nh∆∞ th·∫ø n√†o?", a: ["Gi·ªØ 1 ph·∫ßn, d√πng 1 ph·∫ßn, chia s·∫ª 1 ph·∫ßn", "Gi·ªØ h·∫øt", "Ti√™u h·∫øt", "M·∫∑c k·ªá"], correct: 0, explain: "T√†i ch√≠nh to√†n di·ªán: Gi·ªØ, D√πng, Chia s·∫ª." },
            { q: "ƒê·ªÉ ƒë·∫°t ∆∞·ªõc m∆° c·∫ßn?", a: ["Ng·ªß", "Lao ƒë·ªông & Ti·∫øt ki·ªám", "Ch·ªù ƒë·ª£i", "Xin x·ªè"], correct: 1, explain: "N·ªó l·ª±c l√†m vi·ªác v√† t√≠ch l≈©y." },
            { q: "C√°ch l√†m n√†o l√† ƒë√∫ng khi c√≥ ti·ªÅn?", a: ["Mua ngay", "Ph√¢n v√†o 3 h≈©", "V·ª©t ƒëi", "Gi·∫•u"], correct: 1, explain: "Qu·∫£n l√Ω theo quy t·∫Øc 3 h≈©." }
        ]
    ];

    let currentGroup = 0;
    let currentQIndex = 0;
    let score = 0;
    let isAnswered = false;

    // √Çm thanh
    const soundWin = document.getElementById('sound-win');
    const soundLose = document.getElementById('sound-lose');

    function startQuiz(groupIndex) {
        currentGroup = groupIndex;
        currentQIndex = 0;
        score = 0;
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('group-title').innerText = "FAFI " + (groupIndex + 1);
        loadQuestion();
    }

    function loadQuestion() {
        isAnswered = false;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-area').style.display = 'none';
        
        let data = quizData[currentGroup][currentQIndex];
        let total = quizData[currentGroup].length;
        
        document.getElementById('q-progress').innerText = "C√¢u " + (currentQIndex + 1) + "/" + total;
        document.getElementById('question-text').innerText = data.q;
        
        let qBox = document.getElementById('quiz-screen');
        qBox.style.animation = 'none';
        qBox.offsetHeight; 
        qBox.style.animation = 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';

        let container = document.getElementById('options-container');
        container.innerHTML = '';
        
        data.a.forEach((opt, index) => {
            let btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index, btn);
            container.appendChild(btn);
        });
    }

    function checkAnswer(index, btn) {
        if(isAnswered) return;
        isAnswered = true;
        
        let data = quizData[currentGroup][currentQIndex];
        let feedback = document.getElementById('feedback-area');
        let options = document.querySelectorAll('.option-btn');
        
        if(index === data.correct) {
            btn.classList.add('correct');
            feedback.innerHTML = "üéâ <span style='color:green'>Ch√≠nh x√°c!</span> " + data.explain;
            feedback.style.backgroundColor = "#E8F5E9";
            score++;
            createMoneyRain(5); 
        } else {
            btn.classList.add('wrong');
            options[data.correct].classList.add('correct');
            feedback.innerHTML = "üòÖ <span style='color:red'>Ti·∫øc qu√°!</span> " + data.explain;
            feedback.style.backgroundColor = "#FFEBEE";
        }
        
        feedback.style.display = 'block';
        document.getElementById('next-btn').style.display = 'inline-block';
    }

    function nextQuestion() {
        currentQIndex++;
        if(currentQIndex < quizData[currentGroup].length) {
            loadQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('quiz-screen').style.display = 'none';
        let resultScreen = document.getElementById('result-screen');
        resultScreen.style.display = 'flex'; 
        
        let total = quizData[currentGroup].length;
        document.getElementById('final-score').innerText = score + "/" + total;
        // ƒê√°nh d·∫•u t√∫i ƒë√£ ho√†n th√†nh (Logic ƒë√£ s·ª≠a ƒë√∫ng ID)
        document.getElementById('bag-' + (currentGroup + 1)).classList.add('bag-completed');
        
        let msg = "";

        if (score <= 3) {
            msg = "Ki·∫øn th·ª©c n√†y h∆°i kh√≥ nh·ªâ? Con h√£y xem l·∫°i b√†i h·ªçc v√† th·ª≠ s·ª©c l·∫°i nh√©! C·ªë l√™n!";
            soundLose.currentTime = 0;
            soundLose.play().catch(e => console.log("User interaction required for audio"));
        } else if (score <= 6) {
            msg = "Con l√†m kh√° t·ªët! Ch·ªâ c·∫ßn c·∫©n th·∫≠n h∆°n m·ªôt ch√∫t n·ªØa l√† s·∫Ω ƒë·∫°t ƒëi·ªÉm tuy·ªát ƒë·ªëi. C·ªë g·∫Øng l√™n!";
        } else {
            // ƒê√∫ng 7/7 (V√¨ total l√† 7, n·∫øu score > 6 th√¨ ch·ªâ c√≥ 7)
            msg = "QU√Å XU·∫§T S·∫ÆC! Con ƒë√∫ng l√† m·ªôt 'Th·ªß lƒ©nh T√†i ch√≠nh' th·ª±c th·ª•. Ch√∫c m·ª´ng con!";
            createMoneyRain(30);
            startFireworks();
            soundWin.currentTime = 0;
            soundWin.play().catch(e => console.log("User interaction required for audio"));
        }
        document.getElementById('cheer-msg').innerText = msg;
    }

    function goHome() {
        document.getElementById('result-screen').style.display = 'none';
        document.getElementById('menu-screen').style.display = 'block';
        soundWin.pause(); soundLose.pause();
    }

    function createMoneyRain(amount) {
        for(let i=0; i<amount; i++) {
            let coin = document.createElement('div');
            coin.className = 'coin';
            coin.style.left = Math.random() * 95 + '%';
            coin.style.animationDuration = (Math.random() * 2 + 1.5) + 's';
            coin.style.animationDelay = Math.random() + 's';
            document.querySelector('.game-window').appendChild(coin);
            setTimeout(() => { coin.remove() }, 4000);
        }
    }
</script>

</body>
</html>